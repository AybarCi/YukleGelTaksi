version: '3.8'

services:
  yuklegeltaksi-backoffice:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        REACT_APP_API_URL: https://yuklegeltaksiapi.istekbilisim.com/api
        REACT_APP_BACKEND_URL: https://yuklegeltaksiapi.istekbilisim.com
        REACT_APP_SOCKET_URL: wss://yuklegeltaksiapi.istekbilisim.com
        REACT_APP_ENVIRONMENT: production
        REACT_APP_GOOGLE_MAPS_API_KEY: ""
    image: ghcr.io/aybarci/yuklegeltaksi/backoffice:latest
    container_name: yuklegeltaksi-backoffice
    restart: unless-stopped
    ports:
      - "3004:80"
    environment:
      - NODE_ENV=production
      - REACT_APP_API_URL=https://yuklegeltaksiapi.istekbilisim.com/api
      - REACT_APP_BACKEND_URL=https://yuklegeltaksiapi.istekbilisim.com
      - REACT_APP_SOCKET_URL=wss://yuklegeltaksiapi.istekbilisim.com
      - REACT_APP_ENVIRONMENT=production
    volumes:
      - ./logs:/var/log/nginx
    networks:
      - yuklegeltaksi-backoffice-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    # No longer depends on local backend since we're using external API
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.backoffice.rule=Host(`yuklegeltaksi.istekbilisim.com`)"
      - "traefik.http.routers.backoffice.tls=true"
      - "traefik.http.routers.backoffice.tls.certresolver=letsencrypt"

  # Backend service removed - using external API at http://yuklegeltaksiapi.istekbilisim.com

  # Redis service removed - not needed since backend is external

networks:
  yuklegeltaksi-backoffice-network:
    driver: bridge

# No volumes needed for backoffice-only setup